# Material Shader Replacer (MSR)

Blender 插件，用于批量替换材质中的着色器节点，支持智能连接和自定义规则。

## 功能特性

- **批量替换着色器** - 一键替换选中对象或集合中所有材质的着色器节点
- **智能连接** - 自动匹配和连接输入输出接口，支持语义识别
- **自定义连接规则** - 创建自定义节点连接规则
- **连接关系记录** - 断开连接前自动记录连接关系，辅助重新连接
  - 可控制的连接关系记录功能
  - 动态开关按钮，默认启用
  - 禁用时仅断开连接，不记录连接关系
- **材质缓存** - 避免重复处理相同材质，提升性能
- **节点组支持** - 支持内置着色器和自定义节点组，完美支持中文名称

## 安装

1. 下载 `MSR.zip` 文件
2. 打开 Blender，进入 `编辑 > 偏好设置 > 插件`
3. 点击 `安装`，选择下载的 zip 文件
4. 启用 "Material Shader Replacer" 插件

## 使用方法

### 基础替换

1. 选择要处理的对象
2. 在 3D 视图侧边栏找到 "材质工具" 面板
3. 选择目标着色器：
   - **内置着色器** - 从下拉框选择 Blender 内置着色器
   - **节点组** - 使用搜索框选择自定义节点组（支持中文名称）
4. 选择替换模式：
   - **替换所有着色器** - 替换所有着色器节点
   - **替换特定着色器** - 只替换指定的着色器
5. 点击 "批量替换着色器" 按钮

### 自定义连接规则

1. 在 "连接规则" 部分点击 "+" 添加规则
2. 设置源节点和目标节点（支持按类型或标签匹配）
3. 指定要连接的接口索引
4. 点击 "断开所有连接" 清空现有连接
5. 点击 "使用规则重新连接" 应用规则

### 高级选项

- **自动连接** - 启用智能连接功能，自动匹配输入输出接口
- **目标类型** - 选择处理选中对象或整个集合
- **自定义连接规则** - 创建精确的节点连接规则
- **连接关系记录** - 控制连接关系记录功能
  - 按钮默认显示 "禁用连接关系记录"（当前启用状态）
  - 点击可切换启用/禁用状态，按钮文本动态变化
  - 启用时：断开连接前记录连接关系，点击 "使用规则重新连接" 时恢复连接关系
  - 禁用时：断开连接时不记录连接关系，"使用规则重新连接" 时不恢复连接关系

## 性能优化

- **材质缓存** - 相同材质只处理一次
- **节点组缓存** - 减少重复查询和排序
- **智能连接** - 优化的接口匹配算法

## 系统要求

- Blender 4.3 或更高版本
- 支持 Windows、macOS、Linux

## 版本历史

### v1.3.6 (2026-01-02)

- 可控制的连接关系记录功能
  - 新增"启用/禁用连接关系记录"动态按钮
  - 默认启用连接关系记录
  - 禁用时仅断开连接，不记录连接关系
  - 按钮文本根据当前状态动态变化
  - 使用规则重新连接时仅在启用状态下恢复连接关系

### v1.3.5 (2025-12-29)

- 连接关系快照功能 - 断开连接前自动记录连接关系
- 动态按钮文本 - 断开连接按钮根据替换模式显示不同描述
- 增强的错误处理和用户提示

### v1.3.3 (2025-12-29)

- 重构着色器选择方式，分离内置着色器和节点组选择
- 使用 prop_search 完美支持中文节点组名称
- 实现内置着色器和节点组选择互斥
- 优化UI布局，调整界面元素顺序
- 移除手动输入模式，简化操作流程

### v1.3.1

- 添加材质处理缓存
- 实现节点组缓存
- 统一错误处理机制
- 性能优化

## 许可证

本项目采用开源许可证。

## 反馈与支持

- **Bilibili**: [Homura59](https://space.bilibili.com/37603900)
- **Issues**: 如遇到问题或有功能建议，请提交 Issue
